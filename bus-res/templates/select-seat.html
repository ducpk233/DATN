{% extends "parent.html" %}
{% block content %}
<style >
   *, *:before, *:after {
 box-sizing: border-box !important;
}

.plane {
 margin: 30px auto !important;
 max-width: 200px !important;
}


ol {
 list-style: none !important;
 padding: 0 !important;
 margin: 0 !important;
}

.seats {
 display: flex !important;
 flex-direction: row !important;
 flex-wrap: nowrap !important;
 justify-content: flex-start !important;
}

.seat {
   width: 60px;
   height: 60px;
 display: flex !important;
 flex: 0 0 14.28571428571429% !important;
 padding: 5px !important;
 position: relative !important;
}
.seat:nth-child(3) {
 margin-right: 14.28571428571429% !important;
}
.seat input[type=checkbox] {
  
 position: absolute !important;
 opacity: 0 !important;
}
.seat input[type=checkbox]:checked + label {
 background: black !important;
 -webkit-animation-name: rubberBand !important;
 animation-name: rubberBand !important;
 animation-duration: 300ms !important;
 animation-fill-mode: both !important;
}
.seat input[type=checkbox]:disabled + label {
 background: #dddddd !important;
 text-indent: -9999px !important;
 overflow: hidden !important;
}
.seat input[type=checkbox]:disabled + label:after {
 content: "X" !important;
 text-indent: 0 !important;
 position: absolute !important;
 top: 4px !important;
 left: 50% !important;
 transform: translate(-50%, 0%) !important;
}
.seat input[type=checkbox]:disabled + label:hover {
 box-shadow: none !important;
 cursor: not-allowed !important;
}
.seat label {
 display: block !important;
 position: relative !important;
 width: 100% !important;
 text-align: center !important;
 font-size: 14px !important;
 font-weight: bold !important;
 line-height: 1.5rem !important;
 padding: 4px 0 !important;
 background: lightseagreen !important;
 border-radius: 5px !important;
 animation-duration: 300ms !important;
 animation-fill-mode: both !important;
}
.seat label:before {
 content: "" !important;
 position: absolute !important;
 width: 75% !important;
 height: 75% !important;
 top: 1px !important;
 left: 50% !important;
 transform: translate(-50%, 0%) !important;
 background: rgba(255, 255, 255, 0.4) !important;
 border-radius: 3px !important;
}
.seat label:hover {
 cursor: pointer !important;
 box-shadow: 0 0 0px 2px black !important;
}

.events li { 
     display: flex; 
     color: #999;
   }
   
   .events time { 
     position: relative;
     padding: 0 1em;  }
   
   .events time::after { 
      content: "";
      position: absolute;
      z-index: 2;
      right: 0;
      top: 0;
      transform: translateX(50%);
      border-radius: 50%;
      background: #fff;
      border: 1px #ccc solid;
      width: 1em;
      height: 1em;
   }
   
   
   .events span {
     padding: 0 1.5em 1.5em 1.5em;
     position: relative;
   }
   
   .events span::before {
      content: "";
      position: absolute;
      z-index: 1;
      left: 0;
      height: 100%;
      border-left: 1px #ccc solid;
   }
   
   .events strong {
      display: block;
      font-weight: bolder;
   }
   
   .events { margin: 1em; width: 100%; }
   .events, 
   .events *::before, 
   .events *::after { box-sizing: border-box; font-family: arial; }
   </style>

   <body class="bg-light">
      <!-- Bus Seat Select -->
      <div class="seat-select padding-bt">
         <div class="osahan-header-nav shadow-sm p-3 d-flex align-items-center bg-danger">
            <h5 class="font-weight-normal mb-0 text-white">
               <a class="text-danger mr-3" href="/home"><i class="icofont-rounded-left"></i></a>
               Chọn ghế ngồi
            </h5>
            <div class="ml-auto d-flex align-items-center">
               <a class="toggle osahan-toggle h4 m-0 text-white ml-auto" href="#"><i class="icofont-navigation-menu"></i></a>
            </div>
         </div>
         <!-- Ticket -->
         <div class="ticket p-3">
            <h6 class="mb-1 font-weight-bold text-dark">{{route['TenChuyen']}}</h6>
            <div class="start-rating f-10 mb-3">
               <i class="icofont-star text-danger"></i>
               <i class="icofont-star text-danger"></i>
               <i class="icofont-star text-danger"></i>
               <i class="icofont-star text-danger"></i>
               <i class="icofont-star text-muted"></i>
               <span class="text-dark">4.0</span>
            </div>
            <div class="bg-white rounded-1 shadow-sm p-3 mb-3 w-100">
               <div class="row mx-0 mb-3">
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Tên xe bus</small>
                     <p class="small mb-0 l-hght-14"> {{bus['LoaiXe']}}</p>
                  </div>
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Người điều khiển</small>
                     <p class="small mb-0 l-hght-14">{{driver['HoVaTen']}} </p>
                  </div>
               </div>
               <div class="row mx-0 mb-3">
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Biển số xe</small>
                     <p class="small mb-0 l-hght-14"> {{bus['BienSoXe']}}</p>
                  </div>
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Kinh nghiệm</small>
                     <p class="small mb-0 l-hght-14">{{driver['KinhNghiem']}} </p>
                  </div>
               </div>
               <div class="row mx-0 mb-3">
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Wifi</small>
                     <p class="small mb-0 l-hght-14"> Tốc độ cao sẵn sàng</p>
                  </div>
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Sạc pin</small>
                     <p class="small mb-0 l-hght-14"> Cổng sạc nhanh 18W</p>
                  </div>
               </div>
               <div class="row mx-0 mb-3">
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Đồ ăn vặt</small>
                     <p class="small mb-0 l-hght-14"> Snack, nước uống,...</p>
                  </div>
                  <div class="col-6 p-0">
                     <small class="text-muted mb-1 f-10 pr-1">Ghế chất lượng cao</small>
                     <p class="small mb-0 l-hght-14"> Êm ái, vệ sinh sạch sẽ</p>
                  </div>
               </div>
               
            </div>
            <div class="bg-white rounded-1 shadow-sm p-3 mb-3 w-100">
               <div class="d-flex">
                  Thông tin lộ trình
               </div>
               <ul class="card-body events">
                  {% for p in path %}
                  <li >
                    <time><input class="mid_point_time form-control" readonly type="time" value="{{p.Gio}}"></time> 
                    <span><input class="mid_point_name form-control" type="text" value="{{p.TenDiem}}" readonly></span></li>
                  {% endfor %}                         
              </ul>
              
               
            </div>
            <!-- Select Seat -->
            <div class="select-seat row bg-white mx-0 px-3 pt-3 pb-1 mb-3 rounded-1 shadow-sm">
               <div class="col-8 pl-0">
                  <div class="d-flex">
                     Chọn ghế ngồi
                  </div>
                  <!-- Select Seats -->
                  <div class="select-seat">
                     <div class="checkboxes-seat mt-4">
                        
                        <ol class="cabin fuselage">
                                                
                           <li class="row row--1">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox"  id="1A" />
                                 <label for="1A">1A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="1B" />
                                 <label for="1B">1B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="1C" />
                                 <label for="1C">1C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="1D" />
                                 <label for="1D">1D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="1E" />
                                 <label for="1E">1E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="1F" />
                                 <label for="1F">1F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--2">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="2A" />
                                 <label for="2A">2A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="2B" />
                                 <label for="2B">2B</label>
                               </li>
                               <li class="seat">
                                 <input  name="seat" type="checkbox" id="2C" />
                                 <label for="2C">2C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="2D" />
                                 <label for="2D">2D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="2E" />
                                 <label for="2E">2E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="2F" />
                                 <label for="2F">2F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--3">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="3A" />
                                 <label for="3A">3A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="3B" />
                                 <label for="3B">3B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="3C" />
                                 <label for="3C">3C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="3D" />
                                 <label for="3D">3D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="3E" />
                                 <label for="3E">3E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="3F" />
                                 <label for="3F">3F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--4">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="4A" />
                                 <label for="4A">4A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="4B" />
                                 <label for="4B">4B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="4C" />
                                 <label for="4C">4C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="4D" />
                                 <label for="4D">4D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="4E" />
                                 <label for="4E">4E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="4F" />
                                 <label for="4F">4F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--5">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="5A" />
                                 <label for="5A">5A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="5B" />
                                 <label for="5B">5B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="5C" />
                                 <label for="5C">5C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="5D" />
                                 <label for="5D">5D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="5E" />
                                 <label for="5E">5E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="5F" />
                                 <label for="5F">5F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--6">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="6A" />
                                 <label for="6A">6A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="6B" />
                                 <label for="6B">6B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="6C" />
                                 <label for="6C">6C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="6D" />
                                 <label for="6D">6D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="6E" />
                                 <label for="6E">6E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="6F" />
                                 <label for="6F">6F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--7">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="7A" />
                                 <label for="7A">7A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="7B" />
                                 <label for="7B">7B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="7C" />
                                 <label for="7C">7C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="7D" />
                                 <label for="7D">7D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="7E" />
                                 <label for="7E">7E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="7F" />
                                 <label for="7F">7F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--8">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="8A" />
                                 <label for="8A">8A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="8B" />
                                 <label for="8B">8B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="8C" />
                                 <label for="8C">8C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="8D" />
                                 <label for="8D">8D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="8E" />
                                 <label for="8E">8E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="8F" />
                                 <label for="8F">8F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--9">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="9A" />
                                 <label for="9A">9A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="9B" />
                                 <label for="9B">9B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="9C" />
                                 <label for="9C">9C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="9D" />
                                 <label for="9D">9D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="9E" />
                                 <label for="9E">9E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="9F" />
                                 <label for="9F">9F</label>
                               </li>
                             </ol>
                           </li>
                           <li class="row row--10">
                             <ol class="seats" type="A">
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="10A" />
                                 <label for="10A">10A</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" disabled type="checkbox" id="10B" />
                                 <label for="10B">10B</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="10C" />
                                 <label for="10C">10C</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="10D" />
                                 <label for="10D">10D</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="10E" />
                                 <label for="10E">10E</label>
                               </li>
                               <li class="seat">
                                 <input name="seat" type="checkbox" id="10F" />
                                 <label for="10F">10F</label>
                               </li>
                             </ol>
                           </li>
                         </ol>
                        </div>
                     </div>
                  </div>
               </div>
               
            </div>
            <div class="list_item d-flex col-12 m-0 p-3 bg-white shadow-sm rounded-1 shadow-sm">
               
               <div class="d-flex w-100">
                  <div class="bus_details w-100 pl-3">
                     <p class="mb-2 l-hght-18 font-weight-bold">Thông tin vé</p>
                     <div class="l-hght-10 d-flex align-items-center my-2">
                        <small class="text-muted mb-0 pr-1">Số điện thoại</small>
                        <p class="small mb-0 ml-auto l-hght-14"> {{user.SoDienThoai}}</p>
                     </div>
                     <div class="l-hght-10 d-flex align-items-center my-2">
                        <small class="text-muted mb-0 pr-1">Ngày đi</small>
                        <p class="small mb-0 ml-auto l-hght-14" id="date"> </p>
                     </div>
                     <div class="l-hght-10 d-flex align-items-center my-2">
                        <small class="text-muted mb-0 pr-1">Giá vé 1 ghế</small>
                        <p class="small mb-0 ml-auto l-hght-14"> {{route['GiaVeNguoiLon']}}đ</p>
                     </div>
                     <div class="l-hght-10 d-flex align-items-center my-2">
                        <small class="text-muted mb-0 pr-1">Số ghế đã đặt</small>
                        <p class="small mb-0 ml-auto l-hght-14" id="take_seat"></p>
                     </div>
                     <div class="l-hght-10 d-flex align-items-center mt-3">
                        <p class="mb-0 pr-1 font-weight-bold">Tổng thanh toán</p>
                        <p id="total" class="mb-0 ml-auto l-hght-14 text-danger font-weight-bold"></p>
                     </div>
                     <center><button id="book" class="btn btn-primary" >Đặt vé</button></center>
                     
                  </div>
               </div>
            </div>
         </div>
      </div>
      <input hidden id="giave" value="{{route["GiaVeNguoiLon"]}}"/>
      <input hidden id="route_id" value="{{route["MaChuyen"]}}"/>
      <input hidden id="user_id" value="{{user.SoDienThoai}}"/>
      <!-- slick Slider JS-->
      <script type="text/javascript" src="vendor/slick/slick.min.js"></script>
      <!-- Sidebar JS-->
      <script type="text/javascript" src="vendor/sidebar/hc-offcanvas-nav.js"></script>
      <!-- Custom scripts for all pages-->
      <script>
         $date = new URLSearchParams(window.location.search)
         $param = $date.get('date')
         console.log($param);
         $('#date').text($param);
         $route_id = $('#route_id').val();
         $.ajax({
                url : '/check_avai_seat',
                type : 'POST',
                data : JSON.stringify({'date' : $param,  'route_id' : $route_id}),
                contentType: "application/json;charset=utf-8",
                dataType:'json',
                success : function(res) { 
                    console.log(res['data']);
                    $.each(res['data'], function (i, item) {
                     $('#' + item.IDGhe).attr('disabled', true);
                  }); 
                },
                error : function(request,error)
                {
                    console.log("Request: "+JSON.stringify(request));
                }
         });

         $('.seat').on('change', function(e) { 
            $giave = $('#giave').val();
            // From the other examples
            if (!this.checked) {
               $numberOfChecked = $('input:checkbox:checked').length;
               $total = $giave * + $numberOfChecked
               console.log($numberOfChecked);
               $('#take_seat').text($numberOfChecked);
               $('#total').text(+$giave * + $numberOfChecked + "đ");
            }
         });
         $('#book').click(function() {
            $user_id = $('#user_id').val();
            $route_id = $('#route_id').val();
            $selectedSeat = []
            $('input[name="seat"]:checked').each(function() {
               $selectedSeat.push(this.id);
            });
            if (!$selectedSeat) {
               alert("Bạn chưa chọn ghế nào để đặt vé!")
               return false;
            }
            else {
                  $.ajax({
                     url : '/book_ticket_api',
                     type : 'POST',
                     data : JSON.stringify({'seat' : $selectedSeat,  'route_id' : $route_id, 'user_id' : $user_id, 'total' : $total, 'date' : $param}),
                     contentType: "application/json;charset=utf-8",
                     dataType:'json',
                     success : function(res) { 
                        Swal.fire({
                           title: 'Thành công!',
                           text: 'Đặt vé thành công!',
                           icon: 'warning',
                           
                           confirmButtonText: 'Về danh sách vé',
                           allowOutsideClick: false,
                           allowEscapeKey: false
                        }).then((result) => {
                           if (result.isConfirmed) {
                              window.location.href = "/my_ticket";
                           } 
                           })
                     },
                     error : function(request,error)
                     {
                        console.log("Request: "+JSON.stringify(request));
                     }
               });
            }
         })
      </script>
      {% endblock %}